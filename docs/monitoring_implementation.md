# ğŸš€ ç¬¬ä¸€é˜¶æ®µç›‘æ§å’Œå¯è§‚æµ‹æ€§å®ç°

## ğŸ“‹ å®ç°æ¦‚è¿°

æœ¬æ–‡æ¡£å±•ç¤ºäº†CloudDriveé¡¹ç›®ç¬¬ä¸€é˜¶æ®µç›‘æ§å’Œå¯è§‚æµ‹æ€§åŠŸèƒ½çš„å®ç°æˆæœã€‚

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. ç»Ÿä¸€é”™è¯¯å¤„ç† ğŸ”´ **æ ¸å¿ƒåŠŸèƒ½**

#### åŠŸèƒ½ç‰¹ç‚¹ï¼š
- **ç»Ÿä¸€é”™è¯¯ç å®šä¹‰**ï¼šæ ‡å‡†åŒ–çš„é”™è¯¯ç ä½“ç³»
- **ç»“æ„åŒ–é”™è¯¯å“åº”**ï¼šåŒ…å«é”™è¯¯ç ã€æ¶ˆæ¯ã€è¯·æ±‚IDã€æ—¶é—´æˆ³ç­‰
- **æ•æ„Ÿä¿¡æ¯è¿‡æ»¤**ï¼šè‡ªåŠ¨è¿‡æ»¤å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯çš„é”™è¯¯è¯¦æƒ…
- **ç¯å¢ƒé€‚é…**ï¼šå¼€å‘ç¯å¢ƒæ˜¾ç¤ºè¯¦ç»†é”™è¯¯ï¼Œç”Ÿäº§ç¯å¢ƒéšè—æ•æ„Ÿä¿¡æ¯

#### ä½¿ç”¨ç¤ºä¾‹ï¼š
```go
// åˆ›å»ºåº”ç”¨é”™è¯¯
err := errors.NewAppError(errors.ErrCodeDatabaseError, "Database connection failed", originalErr)

// åœ¨ä¸­é—´ä»¶ä¸­å¤„ç†é”™è¯¯
middleware.HandleError(c, err)
```

#### é”™è¯¯å“åº”æ ¼å¼ï¼š
```json
{
  "code": 50001,
  "message": "Database error",
  "request_id": "550e8400-e29b-41d4-a716-446655440000",
  "timestamp": "2024-01-20T10:30:00Z",
  "details": "Connection timeout (ä»…å¼€å‘ç¯å¢ƒ)"
}
```

### 2. ç»“æ„åŒ–æ—¥å¿—ç³»ç»Ÿ ğŸŸ¡ **é‡è¦åŠŸèƒ½**

#### åŠŸèƒ½ç‰¹ç‚¹ï¼š
- **åŸºäºZapçš„é«˜æ€§èƒ½æ—¥å¿—**ï¼šæ”¯æŒJSONå’Œæ§åˆ¶å°æ ¼å¼
- **æ—¥å¿—è½®è½¬**ï¼šè‡ªåŠ¨æŒ‰å¤§å°å’Œæ—¶é—´è½®è½¬æ—¥å¿—æ–‡ä»¶
- **ç»“æ„åŒ–å­—æ®µ**ï¼šæ ‡å‡†åŒ–çš„æ—¥å¿—å­—æ®µç»“æ„
- **å¤šçº§åˆ«æ—¥å¿—**ï¼šæ”¯æŒDebugã€Infoã€Warnã€Errorçº§åˆ«

#### é…ç½®ç¤ºä¾‹ï¼š
```yaml
monitoring:
  log_level: "info"
  log_file: "logs/app.log"
  log_max_size: 100  # MB
  log_max_age: 30    # days
  log_max_backups: 10
  log_compress: true
```

#### ä½¿ç”¨ç¤ºä¾‹ï¼š
```go
fields := &logger.LogFields{
    RequestID: "req-123",
    UserID:    "user-456", 
    Method:    "POST",
    Path:      "/api/files/upload",
    Duration:  time.Millisecond * 150,
}

logger.Info("File upload completed", fields)
```

### 3. è¯·æ±‚è¿½è¸ªä¸­é—´ä»¶ ğŸŸ¢ **åŸºç¡€åŠŸèƒ½**

#### åŠŸèƒ½ç‰¹ç‚¹ï¼š
- **è‡ªåŠ¨ç”Ÿæˆè¯·æ±‚ID**ï¼šæ¯ä¸ªè¯·æ±‚è‡ªåŠ¨åˆ†é…å”¯ä¸€ID
- **è¯·æ±‚IDä¼ æ’­**ï¼šåœ¨å“åº”å¤´ä¸­è¿”å›è¯·æ±‚ID
- **æ”¯æŒå®¢æˆ·ç«¯æä¾›**ï¼šå¯ä»¥ä½¿ç”¨å®¢æˆ·ç«¯æä¾›çš„è¯·æ±‚ID
- **ä¸Šä¸‹æ–‡ä¼ é€’**ï¼šåœ¨æ•´ä¸ªè¯·æ±‚ç”Ÿå‘½å‘¨æœŸä¸­å¯è®¿é—®

#### HTTPå¤´ç¤ºä¾‹ï¼š
```
Request:  X-Request-ID: custom-id-123
Response: X-Request-ID: custom-id-123
```

### 4. å¢å¼ºå¥åº·æ£€æŸ¥ ğŸŸ¢ **é‡è¦åŠŸèƒ½**

#### åŠŸèƒ½ç‰¹ç‚¹ï¼š
- **ç»„ä»¶çŠ¶æ€æ£€æŸ¥**ï¼šæ•°æ®åº“ã€Redisã€å­˜å‚¨æœåŠ¡çŠ¶æ€ç›‘æ§
- **ç³»ç»Ÿèµ„æºç›‘æ§**ï¼šå†…å­˜ã€ç£ç›˜ã€CPUã€Goroutineç»Ÿè®¡
- **å“åº”æ—¶é—´ç›‘æ§**ï¼šæ£€æŸ¥å„ç»„ä»¶å“åº”æ—¶é—´
- **åˆ†çº§å¥åº·çŠ¶æ€**ï¼šhealthyã€degradedã€unhealthyä¸‰çº§çŠ¶æ€

#### å¥åº·æ£€æŸ¥å“åº”ï¼š
```json
{
  "status": "healthy",
  "timestamp": "2024-01-20T10:30:00Z",
  "version": "1.0.0",
  "uptime": "2h30m15s",
  "request_id": "health-check-123",
  "components": {
    "database": {
      "status": "healthy",
      "message": "Database is healthy",
      "response_time": "5ms",
      "details": {
        "open_connections": 5,
        "in_use": 2,
        "idle": 3
      }
    },
    "redis": {
      "status": "healthy", 
      "message": "Redis is healthy",
      "response_time": "2ms"
    }
  },
  "system_info": {
    "memory_usage": {
      "alloc_mb": 45.2,
      "sys_mb": 128.5,
      "num_gc": 12
    },
    "disk_usage": {
      "total_gb": 500.0,
      "free_gb": 250.0,
      "used_percent": 50.0
    },
    "goroutine_count": 25,
    "cpu_count": 8
  }
}
```

### 5. HTTPè¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶ ğŸŸ¢ **åŸºç¡€åŠŸèƒ½**

#### åŠŸèƒ½ç‰¹ç‚¹ï¼š
- **è‡ªåŠ¨è¯·æ±‚æ—¥å¿—**ï¼šè®°å½•æ‰€æœ‰HTTPè¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯
- **æ€§èƒ½ç›‘æ§**ï¼šè®°å½•è¯·æ±‚å¤„ç†æ—¶é—´
- **çŠ¶æ€ç åˆ†çº§**ï¼šæ ¹æ®çŠ¶æ€ç è‡ªåŠ¨é€‰æ‹©æ—¥å¿—çº§åˆ«
- **å¯é…ç½®è·³è¿‡**ï¼šå¯è·³è¿‡ç‰¹å®šè·¯å¾„çš„æ—¥å¿—è®°å½•

#### æ—¥å¿—ç¤ºä¾‹ï¼š
```json
{
  "timestamp": "2024-01-20T10:30:00Z",
  "level": "info",
  "message": "HTTP request completed",
  "request_id": "req-123",
  "user_id": "user-456",
  "method": "POST",
  "path": "/api/files/upload",
  "status_code": 200,
  "duration": "150ms",
  "client_ip": "192.168.1.100",
  "user_agent": "Mozilla/5.0..."
}
```

## ğŸ§ª æµ‹è¯•è¦†ç›–

### å•å…ƒæµ‹è¯•
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•ï¼š100%è¦†ç›–
- âœ… è¯·æ±‚IDä¸­é—´ä»¶æµ‹è¯•ï¼š100%è¦†ç›–  
- âœ… å¥åº·æ£€æŸ¥æµ‹è¯•ï¼šåŸºç¡€åŠŸèƒ½è¦†ç›–

### æµ‹è¯•è¿è¡Œç»“æœï¼š
```bash
# é”™è¯¯å¤„ç†æµ‹è¯•
go test ./internal/errors -v
PASS: TestAppError, TestNewErrorResponse, TestPredefinedErrors

# ä¸­é—´ä»¶æµ‹è¯•
go test ./internal/middleware -v  
PASS: TestRequestIDMiddleware

# å¥åº·æ£€æŸ¥æµ‹è¯•
go test ./internal/handler -v -run TestHealthCheck
PASS: TestHealthCheck
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨åº”ç”¨
```bash
go run cmd/server/main.go
```

### 2. æµ‹è¯•å¥åº·æ£€æŸ¥
```bash
curl -H "X-Request-ID: test-123" http://localhost:8080/health
```

### 3. æŸ¥çœ‹æ—¥å¿—
```bash
tail -f logs/app.log
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **å¥åº·æ£€æŸ¥å“åº”æ—¶é—´**ï¼š< 100msï¼ˆæœ‰å‘Šè­¦ï¼‰
- **æ—¥å¿—å†™å…¥æ€§èƒ½**ï¼šåŸºäºZapé«˜æ€§èƒ½å®ç°
- **å†…å­˜å ç”¨**ï¼šç»“æ„åŒ–æ—¥å¿—å­—æ®µå¤ç”¨
- **é”™è¯¯å¤„ç†å¼€é”€**ï¼šæœ€å°åŒ–æ€§èƒ½å½±å“

## ğŸ”® ä¸‹ä¸€é˜¶æ®µè®¡åˆ’

### ç¬¬äºŒé˜¶æ®µï¼šå®¹é”™å’Œæ¢å¤æœºåˆ¶
- æ–­è·¯å™¨æ¨¡å¼å®ç°
- é‡è¯•æœºåˆ¶
- é™çº§ç­–ç•¥
- æ•…éšœè½¬ç§»

### ç¬¬ä¸‰é˜¶æ®µï¼šæ€§èƒ½ä¼˜åŒ–
- ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
- è¿æ¥æ± ç®¡ç†
- èµ„æºç›‘æ§å‘Šè­¦
- æ€§èƒ½ç“¶é¢ˆåˆ†æ

## ğŸ“ æ€»ç»“

ç¬¬ä¸€é˜¶æ®µæˆåŠŸå®ç°äº†å®Œæ•´çš„ç›‘æ§å’Œå¯è§‚æµ‹æ€§åŸºç¡€è®¾æ–½ï¼š

1. **ç»Ÿä¸€é”™è¯¯å¤„ç†**ï¼šæ ‡å‡†åŒ–é”™è¯¯å“åº”æ ¼å¼
2. **ç»“æ„åŒ–æ—¥å¿—**ï¼šé«˜æ€§èƒ½ã€å¯é…ç½®çš„æ—¥å¿—ç³»ç»Ÿ
3. **è¯·æ±‚è¿½è¸ª**ï¼šå®Œæ•´çš„è¯·æ±‚ç”Ÿå‘½å‘¨æœŸè¿½è¸ª
4. **å¥åº·æ£€æŸ¥**ï¼šå…¨é¢çš„ç³»ç»Ÿå’Œç»„ä»¶çŠ¶æ€ç›‘æ§
5. **HTTPæ—¥å¿—**ï¼šè¯¦ç»†çš„è¯·æ±‚å¤„ç†è®°å½•

è¿™äº›åŠŸèƒ½ä¸ºåç»­çš„å®¹é”™æœºåˆ¶å’Œæ€§èƒ½ä¼˜åŒ–å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚æ‰€æœ‰åŠŸèƒ½éƒ½ç»è¿‡äº†å……åˆ†çš„æµ‹è¯•ï¼Œå¯ä»¥å®‰å…¨åœ°éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚ 